<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <title>Blockly Demo: Generating Javascript</title>
    <script src="../../static/js/blockly/blockly_compressed.js"></script>
    <script src="../../static/js/blockly/javascript_compressed.js"></script>
    <script src="../../static/js/blockly/blocks_compressed.js"></script>
    <script src="../../static/js/msg/js/en.js"></script>

    <!-- reserved for dynamic Javascripts
      <script src="../../static/js/csXXX.js"></script> 
    -->
    <link rel="stylesheet" href="../../static/css/csblocks.css">

    <style>
    </style>
</head>

<body>
    <p>
        <button onclick="runGame()">Run Block Game</button>
    </p>
    <div id="blocklyDiv" style="height: 480px; width: 600px;"></div>
    <xml xmlns="https://developers.google.com/blockly/xml" id="toolbox" style="display: none">
      <block type="controls_if" id="B2f7{e$SM~24TANvT3qk" x="113" y="37"></block>
      <block type="text_print" id="FyLm/$yIo`I$AOqe(L7z" x="113" y="138">
        <value name="TEXT">
          <shadow type="text" id="A1Kr[Y)3TZHYyr6*o7Bx">
            <field name="TEXT">Hello World</field>
          </shadow>
        </value>
      </block>
      <block type="logic_boolean" id="}t6.]BXO-B~I+Ec_)8TM" x="112" y="188">
        <field name="BOOL">TRUE</field>
      </block>
      <block type="text_print" id="k!D6q7S~sh:P39{FBV3_" x="113" y="237">
        <value name="TEXT">
          <shadow type="text" id=",Q+jU1M?,!r_l?cjfG^E">
            <field name="TEXT">Hello TA!</field>
          </shadow>
        </value>
      </block>
    </xml>
    <!-- <div id="circle"></div> -->

    <script>

var toolbox = document.getElementById("toolbox");

var options = { 
	toolbox : toolbox, 
	collapse : false, 
	comments : false, 
	disable : false, 
	maxBlocks : Infinity, 
	trashcan : false, 
	horizontalLayout : false, 
	toolboxPosition : 'start', 
	css : true, 
	media : 'https://blockly-demo.appspot.com/static/media/', 
	rtl : false, 
	scrollbars : false, 
	sounds : true, 
	oneBasedIndex : true
};

        // put the toolbox in the workspace
        var workspace = Blockly.inject('blocklyDiv',options);

        /* Load Workspace Blocks from XML to workspace. Remove all code below if no blocks to load */

        // TODO: Change workspace blocks XML ID if necessary. Can export workspace blocks XML from Workspace Factory.
        var workspaceBlocks = document.getElementById("toolbox"); 

        // Load blocks to workspace. 
        Blockly.Xml.domToWorkspace(workspaceBlocks, workspace);


        // take the text generated by the blocks and run it as code
        function runGame() {
            // console.log('runCode=============')
            window.LoopTrap = 1000;
            Blockly.JavaScript.INFINITE_LOOP_TRAP = 'if(--window.LoopTrap == 0) throw "Infinite loop.";\n';
            var code = Blockly.JavaScript.workspaceToCode(workspace);
            try {
                eval(code);
            } catch (e) {
                console.log("************************* ", e);
            }
        }
    </script>
</body>

</html>
