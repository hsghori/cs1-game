<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <title>Blockly Demo: Generating Javascript</title>
    <script src="../../static/js/blockly/blockly_compressed.js"></script>
    <script src="../../static/js/blockly/javascript_compressed.js"></script>
    <script src="../../static/js/blockly/blocks_compressed.js"></script>
    <script src="../../static/js/msg/js/en.js"></script>

    <script src="../../static/js/csblocks.js"></script>
    <link rel="stylesheet" href="../../static/css/csblocks.css">

    <style>
    </style>
</head>

<body>
    <p>
        <button onclick="runGame()">Run Block Game</button>
    </p>
    <div id="blocklyDiv" style="height: 480px; width: 600px;"></div>
    <xml id="toolbox" style="display: none;">
        <category name="Logic">
            <block type="lightswitch">
                <field name="lightcolor">red</field>
                <field name="switch">on</field>
            </block>
        </category>
    </xml>

    <div id="square"></div>

    <script>
        // put the toolbox in the workspace
        var workspace = Blockly.inject('blocklyDiv',
            {
                media: 'https://blockly-demo.appspot.com/static/media/',
                toolbox: document.getElementById('toolbox')
            });

        // take the text generated by the blocks and run it as code
        function runGame() {
            // console.log('runCode=============')
            window.LoopTrap = 1000;
            Blockly.JavaScript.INFINITE_LOOP_TRAP = 'if(--window.LoopTrap == 0) throw "Infinite loop.";\n';
            var code = Blockly.JavaScript.workspaceToCode(workspace);
            try {
                eval(code);
            } catch (e) {
                console.log("************************* ", e);
            }
        }
    </script>
</body>

</html>
